{"version":3,"file":null,"sources":["../src/lib/testMeet.js","../src/lib/get-transparent.js","../src/index.js"],"sourcesContent":["export default function (el, options = {}) {\n  // 取得元素在可视区的位置（相对浏览器视窗）左右上下\n  var bcr = el.getBoundingClientRect()\n  // padding+border+width\n  var mw = el.offsetWidth // 元素自身宽度\n  var mh = el.offsetHeight // 元素自身的高度\n  // 包含了导航栏\n  var w = window.innerWidth // 视窗的宽度\n  var h = window.innerHeight // 视窗的高度\n\n  var boolX = (!((bcr.right - options.left) <= 0 && ((bcr.left + mw) - options.left) <= 0) && !((bcr.left + options.right) >= w && (bcr.right + options.right) >= (mw + w))) // 左右符合条件\n  var boolY = (!((bcr.bottom - options.top) <= 0 && ((bcr.top + mh) - options.top) <= 0) && !((bcr.top + options.bottom) >= h && (bcr.bottom + options.bottom) >= (mh + h))) // 上下符合条件\n  return el.width !== 0 && el.height !== 0 && boolX && boolY\n}\n","var canvas = document.createElement('canvas')\ncanvas.getContext('2d').globalAlpha = 0.0\nvar images = {}\n\nexport default function (src, w, h) {\n  if (images[src]) return images[src]\n  canvas.width = w\n  canvas.height = h\n  var data = canvas.toDataURL('image/png')\n  images[src] = data\n  return data\n}\n","import testMeet from './lib/testMeet'\nimport getTransparent from './lib/get-transparent'\nconst _win = window\n\nclass LazyLoadImg {\n  // 构造函数 初始化参数\n  constructor (options = {}) {\n    this.options = {\n      el: document.querySelector('body'), // 选择的元素\n      mode: 'default', // 默认模式，将显示原图，diy模式，将自定义剪切，默认剪切居中部分\n      time: 300, // 设置一个检测时间间隔\n      done: true, // 页面内所有数据图片加载完成后，是否自己销毁程序，true默认销毁，false不销毁：FALSE应用场景：页面异步不断获取数据的情况下 需要实时监听则不销毁\n      diy: { // 此属性，只有在设置diy 模式时才生效\n        backgroundSize: 'cover',\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center center'\n      },\n      position: { // 只要其中一个位置符合条件，都会触发加载机制\n        top: 0, // 元素距离顶部\n        right: 0, // 元素距离右边\n        bottom: 0, // 元素距离下面\n        left: 0 // 元素距离左边\n      },\n      before (el) { // 图片加载之前，执行钩子函数\n\n      },\n      success (el) { // 图片加载成功，执行钩子函数\n\n      },\n      error (el) { // 图片加载失败，执行的钩子函数\n\n      }\n    }\n    // 深拷贝 如果都有 则右面的值 option.position会覆盖this.options.position\n    options.position = Object.assign({}, this.options.position, options.position)\n    options.diy = Object.assign({}, this.options.diy, options.diy)\n    Object.assign(this.options, options)\n    this._timer = true\n    this.start()\n  }\n  start () {\n    var { options } = this\n    clearTimeout(this._timer) // 清除定时器\n    if (!this._timer) return\n    // this._timer 是setTimeout的return flag 推荐采用settimeout的方法，而不是setinterval\n    this._timer = setTimeout(() => {\n      var list = Array.prototype.slice.apply(options.el.querySelectorAll('[data-src]'))\n      // 如果list.length为0 且页面内图片已经加载完毕 清空setTimeout循环\n      if (!list.length && options.done) {\n        clearTimeout(this._timer) // 有页面内的图片加载完成了，自己销毁程序\n      } else {\n        list.forEach((el) => {\n          // 如果该元素状态为空（dataset HTML5方法 设置、获取属性）；并且检测该元素的位置\n          if (!el.dataset.LazyLoadImgState && testMeet(el, options.position)) {\n            this.loadImg(el)\n          }\n        })\n      }\n      // call it\n      this.start()\n    }, options.time)\n  }\n  loadImg (el) { // 加载图片\n    var { options } = this\n    el.dataset.LazyLoadImgState = 'start'\n    // 执行加载之前做的事情\n    options.before.call(this, el)\n    var img = new _win.Image()\n    // 这里是一个坑 dataset.src 实际取的值是 属性data-src data- 是HTML5 DOMStringMap对象\n    img.src = el.dataset.src\n\n    // 图片加载成功\n    img.addEventListener('load', () => {\n      if (options.mode === 'diy') {\n        el.src = getTransparent(el.src, el.width, el.height)\n        options.diy.backgroundImage = 'url(' + img.src + ')'\n        Object.assign(el.style, options.diy)\n      } else {\n        el.src = img.src\n      }\n      delete el.dataset.src\n      el.dataset.LazyLoadImgState = 'success'\n      return options.success.call(this, el)\n    }, false)\n\n    // 图片加载失败\n    img.addEventListener('error', () => {\n      delete el.dataset.src\n      el.dataset.LazyLoadImgState = 'error'\n      options.error.call(this, el)\n    }, false)\n  }\n  destroy () { // 解除事件绑定\n    delete this._timer\n  }\n}\nexport default LazyLoadImg\n"],"names":["el","options","bcr","getBoundingClientRect","mw","offsetWidth","mh","offsetHeight","w","window","innerWidth","h","innerHeight","boolX","right","left","boolY","bottom","top","width","height","canvas","document","createElement","getContext","globalAlpha","images","src","data","toDataURL","_win","LazyLoadImg","querySelector","position","babelHelpers.extends","this","diy","_timer","start","setTimeout","list","Array","prototype","slice","apply","querySelectorAll","length","done","_this","forEach","dataset","LazyLoadImgState","testMeet","loadImg","time","before","call","img","Image","addEventListener","mode","getTransparent","backgroundImage","style","success","error"],"mappings":"sLAAA,OAAe,SAAUA,MAAIC,6DAEvBC,EAAMF,EAAGG,wBAETC,EAAKJ,EAAGK,YACRC,EAAKN,EAAGO,aAERC,EAAIC,OAAOC,WACXC,EAAIF,OAAOG,YAEXC,IAAYX,EAAIY,MAAQb,EAAQc,MAAS,GAAOb,EAAIa,KAAOX,EAAMH,EAAQc,MAAS,GAASb,EAAIa,KAAOd,EAAQa,OAAUN,GAAMN,EAAIY,MAAQb,EAAQa,OAAWV,EAAKI,GAClKQ,IAAYd,EAAIe,OAAShB,EAAQiB,KAAQ,GAAOhB,EAAIgB,IAAMZ,EAAML,EAAQiB,KAAQ,GAAShB,EAAIgB,IAAMjB,EAAQgB,QAAWN,GAAMT,EAAIe,OAAShB,EAAQgB,QAAYX,EAAKK,SAClJ,KAAbX,EAAGmB,OAA6B,IAAdnB,EAAGoB,QAAgBP,GAASG,GCZnDK,EAASC,SAASC,cAAc,SACpCF,GAAOG,WAAW,MAAMC,YAAc,CACtC,IAAIC,QAEW,SAAUC,EAAKnB,EAAGG,MAC3Be,EAAOC,GAAM,MAAOD,GAAOC,KACxBR,MAAQX,IACRY,OAAST,KACZiB,GAAOP,EAAOQ,UAAU,sBACrBF,GAAOC,EACPA,2fCRHE,EAAOrB,OAEPsB,6BAES9B,4EACNA,YACCqB,SAASU,cAAc,aACrB,eACA,UACA,sBAEY,yBACE,+BACE,+BAGf,QACE,SACC,OACF,mBAEAhC,sBAGCA,oBAGFA,QAKDiC,SAAWC,KAAkBC,KAAKlC,QAAQgC,SAAUhC,EAAQgC,YAC5DG,IAAMF,KAAkBC,KAAKlC,QAAQmC,IAAKnC,EAAQmC,OAC5CD,KAAKlC,QAASA,QACvBoC,QAAS,OACTC,6DAGCrC,EAAYkC,KAAZlC,qBACOkC,KAAKE,QACbF,KAAKE,cAELA,OAASE,WAAW,cACnBC,GAAOC,MAAMC,UAAUC,MAAMC,MAAM3C,EAAQD,GAAG6C,iBAAiB,gBAE9DL,EAAKM,QAAU7C,EAAQ8C,kBACbC,EAAKX,UAEbY,QAAQ,SAACjD,IAEPA,EAAGkD,QAAQC,kBAAoBC,EAASpD,EAAIC,EAAQgC,aAClDoB,QAAQrD,OAKdsC,SACJrC,EAAQqD,uCAEJtD,cACDC,EAAYkC,KAAZlC,UACHiD,QAAQC,iBAAmB,UAEtBI,OAAOC,KAAKrB,KAAMnC,MACtByD,GAAM,GAAI3B,GAAK4B,QAEf/B,IAAM3B,EAAGkD,QAAQvB,MAGjBgC,iBAAiB,OAAQ,iBACN,QAAjB1D,EAAQ2D,QACPjC,IAAMkC,EAAe7D,EAAG2B,IAAK3B,EAAGmB,MAAOnB,EAAGoB,UACrCgB,IAAI0B,gBAAkB,OAASL,EAAI9B,IAAM,MACnC3B,EAAG+D,MAAO9D,EAAQmC,QAE7BT,IAAM8B,EAAI9B,UAER3B,GAAGkD,QAAQvB,MACfuB,QAAQC,iBAAmB,UACvBlD,EAAQ+D,QAAQR,OAAWxD,KACjC,KAGC2D,iBAAiB,QAAS,iBACrB3D,GAAGkD,QAAQvB,MACfuB,QAAQC,iBAAmB,UACtBc,MAAMT,OAAWxD,KACxB,2CAGImC,MAAKE"}